<div class="pageContent">
	<form method="post" action="<!@{Smarty_site_url action_method='table/save'}@>" class="pageForm required-validate" onsubmit="return validateCallback(this, navTabAjaxDone);">
		<input type="hidden" name="op" value="<!@{$op}@>" />
        <div class="pageFormContent" layoutH="56">
            <fieldset>
                <legend><!@{$title}@></legend>
                <dl class="nowrap">
                    <dt>表名称:</dt>
                    <dd><input name="tableName" class="textInput required" type="text" size="15" value="<!@{$tableinfo.Name}@>" /></dd>
                </dl>
                <dl class="nowrap">
                    <dt>表引擎:</dt>
                    <dd>
                        <!@{foreach from = $table_engine item = element name=foo}@>
                        <!@{if $element eq $tableinfo.Engine }@>
                            <input name="table_engine" type="radio" class="radio required" checked value="<!@{$element}@>">&nbsp;<!@{$element}@>&nbsp;
                        <!@{else}@>
                              <!@{if $smarty.foreach.foo.iteration eq 1}@>
                                 <input name="table_engine" type="radio" class="radio required" checked value="<!@{$element}@>">&nbsp;<!@{$element}@>&nbsp;
                               <!@{else}@>
                                 <input name="table_engine" type="radio" class="radio required" value="<!@{$element}@>">&nbsp;<!@{$element}@>&nbsp;
                              <!@{/if}@>
                        <!@{/if}@>
                        <!@{/foreach}@>
                    </dd>
                </dl>
                <dl class="nowrap">
                    <dt>表字符集:</dt>
                    <dd>
                        <!@{foreach from = $table_charset item = element name=foo}@>
                        <!@{if $element eq $tableinfo.Collation }@>
                        <input name="table_charset" type="radio" class="radio required" checked value="<!@{$element}@>">&nbsp;<!@{$element}@>&nbsp;
                        <!@{else}@>
                            <!@{if $smarty.foreach.foo.iteration eq 1}@>
                            <input name="table_charset" type="radio" class="radio required" checked value="<!@{$element}@>">&nbsp;<!@{$element}@>&nbsp;
                            <!@{else}@>
                            <input name="table_charset" type="radio" class="radio required" value="<!@{$element}@>">&nbsp;<!@{$element}@>&nbsp;
                            <!@{/if}@>
                        <!@{/if}@>
                        <!@{/foreach}@>
                    </dd>
                </dl>
                <dl>
                    <dt>ID自增:</dt>
                    <dd>
                        <!@{if $primary_field[0].Extra eq 'auto_increment'}@>
                        <input type="radio" name="autocrement" checked value="auto_increment" >自增
                        <input type="radio" name="autocrement"  value="" >不自增
                        <!@{elseif $primary_field[0].Extra eq ''}@>
                        <input type="radio" name="autocrement"  checked value="auto_increment" >自增
                        <input type="radio" name="autocrement"  value="" >不自增
                        <!@{else}@>
                        <input type="radio" name="autocrement"   value="auto_increment" >自增
                        <input type="radio" name="autocrement"  checked value="" >不自增
                        <!@{/if}@>
                    </dd>
                </dl>
                <dl>
                    <dt>需要主键:</dt>
                    <dd>
                        <!@{if $is_primary}@>
                        <input type="radio" name="isprimarykey" checked  value="1" >是
                        <input type="radio" name="isprimarykey"  value="0" >否
                        <!@{elseif $is_primary eq ''}@>
                        <input type="radio" name="isprimarykey" checked  value="1" >是
                        <input type="radio" name="isprimarykey"   value="0" >否
                        <!@{else}@>
                        <input type="radio" name="isprimarykey"   value="1" >是
                        <input type="radio" name="isprimarykey"  checked value="0" >否
                        <!@{/if}@>
                    </dd>
                </dl>
            </fieldset>
            <fieldset>
                <legend>附加选项</legend>
                <dl class="nowrap">
                    <dt>描述表名(中文):</dt>
                    <dd><input name="desp" class="textInput required" type="text" size="15" value="<!@{$tableconfig.desp}@>" /></dd>
                </dl>
                <dl class="nowrap">
                    <dt>自动生成后台表单:</dt>
                    <dd>
                        <!@{if $tableconfig.auto_form_fields neq 1}@>
                        <input type="radio" name="auto_form"  value="1" >是
                        <input type="radio" name="auto_form" checked value="0" >否
                        <!@{else}@>
                        <input type="radio" name="auto_form" checked value="1" >是
                        <input type="radio" name="auto_form"  value="0" >否
                        <!@{/if}@>
                    </dd>
                </dl>
            </fieldset>
            <!@{foreach from = $fields item = element name= foo}@>
            <!@{if $smarty.foreach.foo.iteration eq 1}@>
            <fieldset>
                <legend>字段&nbsp;<input type="button" name="" class="btn_orange" value="新增字段" onclick="addColumn()"/>[如果需要主键,该字段为主键名称]</legend>
                <dl class="nowrap">
                    <dt>名称:</dt>
                    <dd><input name="column1" class="textInput required" type="text" size="15" value="<!@{$element.Field}@>" /> </dd>
                </dl>
                <dl class="nowrap">
                    <dt>类型:</dt>
                    <dd><select class="typecombox" name="type1">
                        <!@{foreach from=$field_types item = field_type}@>
                            <!@{if $field_type eq $element.Type}@>
                                 <option value="<!@{$field_type}@>" selected><!@{$field_type}@></option>
                            <!@{else}@>
                                 <option value="<!@{$field_type}@>"><!@{$field_type}@></option>
                            <!@{/if}@>
                        <!@{/foreach}@>
                    </select></dd>
                </dl>
                <dl class="nowrap">
                    <dt>长度:</dt>
                    <dd><input name="length1" class="textInput digits" type="text" size="5" value="<!@{$element.Length|default:''}@>" /></dd>
                </dl>
                <dl class="nowrap">
                    <dt>描述:</dt>
                    <dd><input  name="comment1" class="textInput" type="text" size="30" value="<!@{$element.Comment|default:''}@>" /></dd>
                </dl>
                <dl class="nowrap">
                    <dt>允许为空:</dt>
                    <dd>
                        <!@{if $element.Null eq 'YES'}@>
                        &nbsp;&nbsp;<input type="radio" name="isnull1" checked value="">&nbsp;null
                        &nbsp;&nbsp;<input type="radio" name="isnull1" value="not null">&nbsp;not null
                        <!@{else}@>
                        &nbsp;&nbsp;<input type="radio" name="isnull1"  value="">&nbsp;null
                        &nbsp;&nbsp;<input type="radio" name="isnull1" checked value="not null">&nbsp;not null
                        <!@{/if}@>
                    </dd>
                </dl>
                <dl class="nowrap">
                    <dt>默认值:</dt>
                    <dd><input  name="default1" class="textInput" type="text" size="30" value="<!@{$element.Default}@>" /></dd>
                </dl>
            </fieldset>
            <!@{else}@>
            <fieldset>
                <legend>字段&nbsp;<input type="button" name="" class="btn_grey" value="删除字段" onclick="delColumn(this)"/></legend>
                <dl class="nowrap">
                    <dt>名称:</dt>
                    <dd><input name="column<!@{$smarty.foreach.foo.iteration}@>" class="textInput required" type="text" size="15" value="<!@{$element.Field}@>" /> </dd>
                </dl>
                <dl class="nowrap">
                    <dt>类型:</dt>
                    <dd><select class="typecombox" name="type<!@{$smarty.foreach.foo.iteration}@>">
                        <!@{foreach from=$field_types item = field_type}@>
                        <!@{if $field_type eq $element.Type}@>
                        <option value="<!@{$field_type}@>" selected><!@{$field_type}@></option>
                        <!@{else}@>
                        <option value="<!@{$field_type}@>"><!@{$field_type}@></option>
                        <!@{/if}@>
                        <!@{/foreach}@>
                    </select></dd>
                </dl>
                <dl class="nowrap">
                    <dt>长度:</dt>
                    <dd><input name="length<!@{$smarty.foreach.foo.iteration}@>" class="textInput digits" type="text" size="5" value="<!@{$element.Length|default:''}@>" /></dd>
                </dl>
                <dl class="nowrap">
                    <dt>描述:</dt>
                    <dd><input  name="comment<!@{$smarty.foreach.foo.iteration}@>" class="textInput" type="text" size="30" value="<!@{$element.Comment|default:''}@>" /></dd>
                </dl>
                <dl class="nowrap">
                    <dt>允许为空:</dt>
                    <dd>
                        <!@{if $element.Null eq 'YES'}@>
                        &nbsp;&nbsp;<input type="radio" name="isnull<!@{$smarty.foreach.foo.iteration}@>" checked value="">&nbsp;null
                        &nbsp;&nbsp;<input type="radio" name="isnull<!@{$smarty.foreach.foo.iteration}@>" value="not null">&nbsp;not null
                        <!@{else}@>
                        &nbsp;&nbsp;<input type="radio" name="isnull<!@{$smarty.foreach.foo.iteration}@>"  value="">&nbsp;null
                        &nbsp;&nbsp;<input type="radio" name="isnull<!@{$smarty.foreach.foo.iteration}@>" checked value="not null">&nbsp;not null
                        <!@{/if}@>
                    </dd>
                </dl>
                <dl class="nowrap">
                    <dt>默认值:</dt>
                    <dd><input  name="default<!@{$smarty.foreach.foo.iteration}@>" class="textInput" type="text" size="30" value="<!@{$element.Default}@>" /></dd>
                </dl>
            </fieldset>
            <!@{/if}@>
            <!@{/foreach}@>

		</div>
		<div class="formBar">
			<ul>
				<!--<li><a class="buttonActive" href="javascript:;"><span>保存</span></a></li>-->
				<li><div class="buttonActive"><div class="buttonContent"><button type="submit" >保存</button></div></div></li>
				<li>
					<div class="button"><div class="buttonContent"><button type="button" class="close">取消</button></div></div>
				</li>
			</ul>
		</div>
        <input type="hidden" name="flag" id="flag" value="1" /><!--告诉后台这个表有多少个字段-->
	</form>
</div>
<script>
var fieldtypes = '<!@{$field_types_str}@>';
var fieldoptions = makeOptions();

var flag = <!@{$field_nums}@>;


function makeOptions(){
    if(fieldtypes!=''){
        fieldtypes = fieldtypes.split(',');
        var fieldoptions = '';
        for(var i =0 ; i< fieldtypes.length; i++){
            fieldoptions += '<option value="'+fieldtypes[i]+'">'+fieldtypes[i]+'</option>';
        }
        return fieldoptions;
    }
}

function addColumn(){
   flag++;
   $("#flag").val(flag);
   var column_template = createColumn();
   $(".pageFormContent").append(column_template);
}


function createColumn(){
    var column_template =   '';
    column_template +=      '<fieldset>';
    column_template +=      '<legend>字段&nbsp;<input type="button" name="" class="btn_grey" value="删除字段" onclick="delColumn(this)"/></legend>';
    column_template +=      '<dl class="nowrap">';
    column_template +=      '<dt>名称:</dt>';
    column_template +=      '<dd><input name="column'+flag+'" class="textInput required" type="text" size="15" value="" /> </dd>';
    column_template +=      '</dl>';
    column_template +=      '<dl class="nowrap">';
    column_template +=      '<dt>类型:</dt>';
    column_template +=      '<dd><select class="typecombox" name="type'+flag+'">'+fieldoptions+'</select></dd>';
    column_template +=      '</dl>';
    column_template +=      '<dl class="nowrap">';
    column_template +=      '<dt>长度:</dt>';
    column_template +=      '<dd><input name="length'+flag+'" class="textInput digits" type="text" size="5" value="" /></dd>';
    column_template +=      '</dl>';
    column_template +=      '<dl class="nowrap">';
    column_template +=      '<dt>描述:</dt>';
    column_template +=      '<dd><input  name="comment'+flag+'" class="textInput" type="text" size="30" value="" /></dd>';
    column_template +=      '</dl>';
    column_template +=      '<dl class="nowrap">';
    column_template +=      '<dt>允许为空:</dt>';
    column_template +=      '<dd>&nbsp;&nbsp;<input type="radio" name="isnull'+flag+'" checked value="">&nbsp;null&nbsp;&nbsp;<input type="radio" name="isnull'+flag+'" value="not null">&nbsp;not null</dd>';
    column_template +=      '</dl>';
    column_template +=      '<dl class="nowrap">';
    column_template +=      '<dt>默认值:</dt>';
    column_template +=      '<dd><input  name="default'+flag+'" class="textInput" type="text" size="30" value="" /></dd>';
    column_template +=      '</dl>';
    column_template +=      '</fieldset>';
    return column_template;
}

function delColumn(node){
    $(node).parent().parent().remove();
    flag--;
}
</script>



